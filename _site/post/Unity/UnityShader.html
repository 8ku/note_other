<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <!-- <link rel="stylesheet" href="/note_other/assets/css/syntax.css"> -->
    
<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>note_other | 书籍以外的各种笔记</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="note_other" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="书籍以外的各种笔记" />
<meta property="og:description" content="书籍以外的各种笔记" />
<link rel="canonical" href="http://localhost:4000/note_other/post/Unity/UnityShader.html" />
<meta property="og:url" content="http://localhost:4000/note_other/post/Unity/UnityShader.html" />
<meta property="og:site_name" content="note_other" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="note_other" />
<script type="application/ld+json">
{"url":"http://localhost:4000/note_other/post/Unity/UnityShader.html","headline":"note_other","description":"书籍以外的各种笔记","@type":"WebPage","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <!-- 字体自适应放大 -->
    <link rel="stylesheet" href="/note_other/assets/css/style.css?v=6e16c63238836bca6af2e9013f7f75717d6f21ee">
    <script src="/note_other/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!-- 显示页内目录 -->
    <!-- <script src="https://raw.githubusercontent.com/8ku/note_other/master/_js/jquery-3.5.1.min.js" type="text/javascript"></script> 
    <script src="https://raw.githubusercontent.com/8ku/note_other/master/_js/toc.js" type="text/javascript"></script> -->


	<!-- 显示数学公式 -->
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
            inlineMath: [['$','$']]
            }
        });
    </script> 

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>

    <div class="wrapper">
      <header>
        <h1 class="header"><a href="/note_other">note_other</a></h1>
        <p class="header">书籍以外的各种笔记</p>    
        <ul> 
          <li><a class="header name" href="https://8ku.github.io/note_other/search">Search</a></li>     	
        	<li><a class="header name" href="https://8ku.github.io/note_other/post/Code/summary">Code</a></li>
        	<li><a class="header name" href="https://8ku.github.io/note_other/post/Unity/summary">Unity</a></li>
        	<li><a class="header name" href="https://8ku.github.io/note_other/post/math/summary">Math</a></li>
        	<li><a class="header name" href="https://8ku.github.io/note_other/post/RegularExpression/summary">RegularExpression</a></li>
        	<li><a class="header name" href="https://8ku.github.io/note_other/post/system/summary">System</a></li>
        	<li><a class="header name" href="https://8ku.github.io/note_other/post/WomensHistory/summary">WomensHistory</a></li>
        	<li><a class="header name" href="https://8ku.github.io/note_other/post/mythology/summary">Mythology</a></li>
        	<li><a class="header name" href="https://8ku.github.io/note_other/post/GameHistory/summary">GameHistory</a></li>
        	<li><a class="header name" href="/note_other/post/Biology/summary">Biology</a></li>
        	<li><a class="header name" href="/note_other/post/Draw/summary">Draw</a></li>
        </ul>

        <ul>
            <li><a class="buttons github" href="https://github.com/8ku/note_other">GitHub</a></li>
        </ul>

        <!-- <ul>
          
          <li><a class="buttons github" href="https://github.com/8ku/note_other">View On GitHub</a></li>
        </ul> --> 

        <!-- 
          <p class="header">This project is maintained by <a class="header name" href="https://github.com/8ku">8ku</a></p>
         -->

        <!--   -->
      </header>

      <div id="toc"></div>
      <section>

        <head>
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
            inlineMath: [['$','$']]
            }
        });
    </script>
      <script src="https://unpkg.com/mermaid@8.0.0/dist/mermaid.min.js"></script>
      <script>mermaid.initialize({startOnLoad:true});</script>
</head>
<h1 id="unity-shader">Unity Shader</h1>

<ul id="markdown-toc">
  <li><a href="#unity-shader" id="markdown-toc-unity-shader">Unity Shader</a>    <ul>
      <li><a href="#安装配置" id="markdown-toc-安装配置">安装配置</a></li>
      <li><a href="#使用摄像机特效" id="markdown-toc-使用摄像机特效">使用摄像机特效</a>        <ul>
          <li><a href="#建立依赖" id="markdown-toc-建立依赖">建立依赖</a></li>
          <li><a href="#相机景深" id="markdown-toc-相机景深">相机景深</a></li>
          <li><a href="#相机暗角" id="markdown-toc-相机暗角">相机暗角</a></li>
          <li><a href="#颗粒感" id="markdown-toc-颗粒感">颗粒感</a></li>
        </ul>
      </li>
      <li><a href="#设置调整" id="markdown-toc-设置调整">设置调整</a>        <ul>
          <li><a href="#阴影清晰度优化" id="markdown-toc-阴影清晰度优化">阴影清晰度优化</a></li>
        </ul>
      </li>
      <li><a href="#特效渲染节点" id="markdown-toc-特效渲染节点">特效渲染节点</a>        <ul>
          <li><a href="#玻璃" id="markdown-toc-玻璃">玻璃</a></li>
          <li><a href="#卡通配色" id="markdown-toc-卡通配色">卡通配色</a></li>
        </ul>
      </li>
      <li><a href="#贴图" id="markdown-toc-贴图">贴图</a>        <ul>
          <li><a href="#漫贴反射图要点" id="markdown-toc-漫贴反射图要点">漫贴反射图要点</a></li>
          <li><a href="#贴图大小设置" id="markdown-toc-贴图大小设置">贴图大小设置</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<p>在Unity中使用node创建和编辑着色器.</p>

<h2 id="安装配置">安装配置</h2>

<ul>
  <li>安装<code class="language-plaintext highlighter-rouge">Shadergraph</code> 和 <code class="language-plaintext highlighter-rouge">Universal RP</code> 包</li>
  <li><code class="language-plaintext highlighter-rouge">Edit &gt; Render Pipeline &gt; Universal Render Pipeline &gt; Upgrade ...</code> 更新原来的Unity自带Shader(如果切换后材质变红)</li>
  <li>创建设置SRP : 菜单栏<code class="language-plaintext highlighter-rouge">Assets &gt; Create &gt; Rendering&gt;Universal Pipeline Asset</code>，会创建出来一个文件，这是渲染管线的配置文件。</li>
  <li>在菜单栏 <code class="language-plaintext highlighter-rouge">Edit &gt; Project Settings &gt; Graphics</code> 中设置刚才的SRP文件</li>
  <li>创建ShaderGraph文件: <code class="language-plaintext highlighter-rouge">Create &gt; Shader &gt; PBR / Sub / Unlit Graph</code>
    <ul>
      <li><em>PBR Graph</em> PBR图</li>
      <li><em>Sub Graph</em> 子图，用于创建一些可复用的节点</li>
      <li><em>Unlit Graph</em> 不受光照的图</li>
    </ul>
  </li>
  <li>双击打开Shader Graph 窗口</li>
</ul>

<h2 id="使用摄像机特效">使用摄像机特效</h2>

<h3 id="建立依赖">建立依赖</h3>

<ul>
  <li>
    <p>在 Hierarchy 新建一个 Volume –&gt; Global Volume, 置于最顶层</p>

    <ul>
      <li>新建一个Profile</li>
      <li>模式选择Global的话会针对所有物体有效</li>
    </ul>
  </li>
  <li>
    <p>在MainCamera - Renderer</p>

    <ul>
      <li>勾选 Post Processing</li>
    </ul>
  </li>
  <li>
    <p style="background-color:red;">
   Global Volume的 Layer 必须包含在 Main Camera - Environment - Volume Mask 层中, 不然无法生效
</p>
  </li>
</ul>

<h3 id="相机景深">相机景深</h3>

<ul>
  <li>在Global Volume中添加 Depth Of Field</li>
  <li>Mode: Gaussian(快, 资源消耗少) / Bokeh(慢, 真实, 资源消耗多)</li>
</ul>

<h3 id="相机暗角">相机暗角</h3>

<p>添加 Vigentte</p>

<h3 id="颗粒感">颗粒感</h3>

<p>添加 Film Grain ( 杂色是动态的, 效果不是很好)</p>

<h2 id="设置调整">设置调整</h2>

<h3 id="阴影清晰度优化">阴影清晰度优化</h3>

<ul>
  <li>打开UniversalRenderPipelineAsset</li>
  <li>找到<code class="language-plaintext highlighter-rouge">Shadows</code>, 调整<code class="language-plaintext highlighter-rouge">Cascades</code>为更高</li>
  <li><code class="language-plaintext highlighter-rouge">Lightning - Shadow Resolution</code> 调整为更高</li>
  <li>调整<code class="language-plaintext highlighter-rouge">Shadows</code> 的 <code class="language-plaintext highlighter-rouge">Deptch Bias</code> 和 <code class="language-plaintext highlighter-rouge">Normal Bias</code></li>
</ul>

<h2 id="特效渲染节点">特效渲染节点</h2>

<h3 id="玻璃">玻璃</h3>

<p><img src="/note_other/post/Unity/UnityShader.assets/Glass_shade_node.jpg" alt="Glass_shade_node" /></p>

<p>其中的<code class="language-plaintext highlighter-rouge">Custom Function</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre>Input
Normal Vector3
ViewDir Vector3
IndewofRef Vector1

Outputs
Out Vector3

Type: String
Name: Refraction
Body:
Out = refract(ViewDir, Normal, IndexofRef);
</pre></td></tr></tbody></table></code></pre></div></div>

<p><a href="https://www.codinblack.com/glass-shader-using-shader-graph-in-unity3d/">教程</a></p>

<h3 id="卡通配色">卡通配色</h3>

<p style="background-color:red;color:white;">加上多类型灯光的配置后出现强反射, 不能用</p>

<p>最终文件包含:</p>

<ul>
  <li>Shader Material</li>
  <li>Texture
    <ul>
      <li>灰白色阶贴图</li>
      <li>漫反射表面贴图</li>
    </ul>
  </li>
  <li>hlsl文件</li>
  <li>Shader Graph
    <ul>
      <li>Toon Shader
        <ul>
          <li>CalculateLight
            <ul>
              <li>CalculateMainLight</li>
              <li>AddAdditionLight</li>
            </ul>
          </li>
          <li>CalculateLightRamp</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>步骤:</p>

<ul>
  <li>
    <p>新建一个Unlit Shader, 命名为 <code class="language-plaintext highlighter-rouge">Toon Shader</code></p>
  </li>
  <li>
    <p>新建一个文件夹 Includes, 新建<code class="language-plaintext highlighter-rouge">Lighting.hlsl</code>文件, (mac)下用sublime打开(添加 <code class="language-plaintext highlighter-rouge">HLSL Syntax</code>插件)</p>

    <pre><code class="language-hlsl ">#ifndef CUSTOM_LIGHTING_INCLUDED
#define CUSTOM_LIGHTING_INCLUDED
  
// CalculateMainLight是方法名 float是告诉Unity用的是什么类型的值
void CalculateMainLight_float(float3 WorldPos, out float3 Direction, out float3 Color){
#if SHADERGRAPH_PREVIEW
	Direction = float3(0.5, 0.5, 0);
	Color = 1;
#else
	Light mainLight = GetMainLight(0);
	Direction = mainLight.direction;
	Color = mainLight.color;
#endif
  
}
#endif
</code></pre>
  </li>
  <li>
    <p>在 Unilit Shaer 中新建一个<code class="language-plaintext highlighter-rouge">Custom Function</code>, 按上一步定义的值添加 input out value</p>

    <ul>
      <li>Input : WorldPos - Vector3</li>
      <li>output: Direction - Vector3</li>
      <li>output: Color - Vector3</li>
      <li>type: File</li>
      <li>Name: CalculateMainLight</li>
      <li>Source: Lighting.hlsl</li>
    </ul>
  </li>
  <li>
    <p>添加一个<code class="language-plaintext highlighter-rouge">Position</code>(Absolute World) - <code class="language-plaintext highlighter-rouge">Custom Function</code></p>
  </li>
  <li>
    <p>add <code class="language-plaintext highlighter-rouge">Normal Vector</code>(法线方向)  <code class="language-plaintext highlighter-rouge">dot product</code>(乘积)</p>

    <div class="mermaid">
graph LR
A[CustomFunction] &amp; B[NormalVector] --&gt; C[dotproduct]       
</div>

    <p><img src="/note_other/post/Unity/UnityShader.assets/ToonShader1.jpg" alt="ToonShader1" /></p>
  </li>
  <li>
    <p>添加一个文件夹 <code class="language-plaintext highlighter-rouge">SubGraphs</code>, 把红框框起的nodes 选中, 右键<code class="language-plaintext highlighter-rouge">convert to sub-graph</code> 放入文件夹, 命名为 <code class="language-plaintext highlighter-rouge">CalculateLight</code></p>

    <ul>
      <li>进入sub graph, 在Out_Vector3中添加两个变量
        <ul>
          <li>Diffuse - Vector1</li>
          <li>Color - Vector3</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p>创建一个Texture 文件夹, 放入黑白色阶贴图</p>
  </li>
  <li>
    <p>回到Toon Shader, 在 Blackboard 添加一个Texure2D, 命名为<code class="language-plaintext highlighter-rouge">ToonRamp</code></p>
  </li>
  <li>
    <p>添加一个<code class="language-plaintext highlighter-rouge">Sample Texture 2D LOD</code> 节点, <code class="language-plaintext highlighter-rouge">ToonRamp --&gt; Sample Texture 2D LOD(Texture)</code>, LOD adjust the level of detail of the sample</p>
  </li>
  <li>
    <p>添加一个<code class="language-plaintext highlighter-rouge">Sample State(wrap:Clamp) --&gt; Sample Texture 2D LOD(Sampler)</code></p>
  </li>
  <li>
    <p>添加一个<code class="language-plaintext highlighter-rouge">Vector2</code>, <code class="language-plaintext highlighter-rouge">CalculateLight(Diffuse) --&gt; Vector2(x) --&gt; Sample Texture 2D LOD(UV)</code></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Sample Texture 2D LOD(R) --&gt; Multiply(B)</code></p>

    <p><img src="/note_other/post/Unity/UnityShader.assets/ToonShader2.jpg" alt="ToonShader2" /></p>
  </li>
  <li>
    <p>选中当前<strong>除CalculateLight以外</strong>所有节点, 右键保存为sub-Graph, 命名为 <code class="language-plaintext highlighter-rouge">CalculateLightingRamp</code></p>

    <ul>
      <li>重命名Blackboard的两个节点为 <code class="language-plaintext highlighter-rouge">Attenuation</code> <code class="language-plaintext highlighter-rouge">Color</code>, 输出值为<code class="language-plaintext highlighter-rouge">Out</code></li>
    </ul>
  </li>
  <li>
    <p>在Toon Shader添加一个Texture2D, 命名为<code class="language-plaintext highlighter-rouge">Diffure Texture</code>, 放漫反射贴图, 添加<code class="language-plaintext highlighter-rouge">Sample Texture 2D</code> <code class="language-plaintext highlighter-rouge">Diffuse Texture --&gt; Sample Texture 2D(Texture)</code></p>

    <ul>
      <li>
        <p>如果使用颜色而不是贴图做漫反射表面的话, 添加 Color 节点</p>

        <p><img src="/note_other/post/Unity/UnityShader.assets/ToonShader2-1.jpg" alt="ToonShader2-1" /></p>
      </li>
    </ul>
  </li>
  <li>
    <p>添加 UV 节点 <code class="language-plaintext highlighter-rouge">UV --&gt; Sample Texture 2D(UV)</code></p>
  </li>
  <li>
    <p>添加一个<code class="language-plaintext highlighter-rouge">Multiply</code>节点</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">Sample Texture 2D(RGBA) --&gt; Multiply(A)</code></li>
      <li><code class="language-plaintext highlighter-rouge">Calculate Lighting Ramp(Out) --&gt; Multiply(B)</code></li>
      <li><code class="language-plaintext highlighter-rouge">Multiply(Out) --&gt; Unlit Master(Color)</code></li>
    </ul>
  </li>
  <li>
    <p>在<code class="language-plaintext highlighter-rouge">Lighting.hlsl</code>中添加如下代码以让shader接收阴影</p>

    <p>新增 <code class="language-plaintext highlighter-rouge">out half DistanceAtten</code> <code class="language-plaintext highlighter-rouge">out half ShadowAtten</code></p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="rouge-code"><pre>#ifndef CUSTOM_LIGHTING_INCLUDED
#define CUSTOM_LIGHTING_INCLUDED
  
void CalculateMainLight_float(float3 WorldPos, out float3 Direction, out float3 Color, out half DistanceAtten, out half ShadowAtten){
#if SHADERGRAPH_PREVIEW
	Direction = float3(0.5, 0.5, 0);
	Color = 1;
	DistanceAtten = 1;
	ShadowAtten = 1;
  
#else
	#if SHADOWS_SCREEN
		half4 clipPos = TransformWorldToHClip(WorldPos);
		half4 shadowCoord = ComputeScreenPos(clipPos);
	#else
		half4 shadowCoord = TransformWorldToShadowCoord(WorldPos);
	#endif
  
	Light mainLight = GetMainLight(shadowCoord);
	Direction = mainLight.direction;
	Color = mainLight.color;
  
	DistanceAtten = mainLight.distanceAttenuation;
	ShadowAtten = mainLight.shadowAttenuation;
#endif
  
}
#endif
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">CalculateLight - Custom Function - Outputs</code>  新增</p>

    <ul>
      <li>DistanceAtten - Vector1</li>
      <li>ShadowAtten - Vector1</li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">CalculateLight</code> 新增两个<code class="language-plaintext highlighter-rouge">Multiply</code>节点, 连接如下</p>

    <p><img src="/note_other/post/Unity/UnityShader.assets/ToonShader3.jpg" alt="ToonShader3" /></p>
  </li>
  <li><code class="language-plaintext highlighter-rouge">Toon Shader - Blackboard</code> 添加3个 <code class="language-plaintext highlighter-rouge">Boolean</code>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">Shadows</code>
        <ul>
          <li>Reference: _MAIN_LIGHT_CALCULATE_SHADOWS</li>
          <li>Definition: Multi Compile</li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">Shadows Cascade</code>
        <ul>
          <li>Reference: _MAIN_LIGHT_SHADOWS_CASCADE</li>
          <li>Definition: Multi Compile</li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">Soft Shadows</code>
        <ul>
          <li>Reference: _SHADOWS_SOFT</li>
          <li>Definition: Multi Compile</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p>在 Toon Shader - Inspector 面板 切换到 Debug 模式, 把上一步的 Reference 添加到 Shader Keywords 中, 用空格隔开</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">_MAIN_LIGHT_CALCULATE_SHADOWS _MAIN_LIGHT_SHADOWS_CASCADE _SHADOWS_SOFT</code></li>
    </ul>
  </li>
  <li>
    <p><strong>添加支持spot light/point light的反射设置</strong></p>

    <ul>
      <li>
        <p>复制所有<code class="language-plaintext highlighter-rouge">CalculateLight</code>里的节点, 新建为<code class="language-plaintext highlighter-rouge">CalculateMainLight</code>的sub-graph</p>
      </li>
      <li>
        <p><strong>添加调整光滑的节点</strong></p>

        <ul>
          <li>blackBoard添加一个Vector1: Smoothness</li>
          <li>添加Multiply, <code class="language-plaintext highlighter-rouge">Smoothness --&gt; Multiply A(1)</code> B(1): 20</li>
          <li>添加 Add, <code class="language-plaintext highlighter-rouge">Multiply --&gt; Add A(1)</code> B(1) : 1</li>
          <li>添加 Exponential, <code class="language-plaintext highlighter-rouge">Add --&gt; Exponential</code>, Base: Base 2</li>
          <li>把红框中除<code class="language-plaintext highlighter-rouge">Smoothness</code>以外的三个节点做成sub_graph, <code class="language-plaintext highlighter-rouge">AdjustSmoothness</code></li>
        </ul>

        <p><img src="/note_other/post/Unity/UnityShader.assets/ToonShader4.jpg" alt="ToonShader4" /></p>
      </li>
      <li>
        <p>进入<code class="language-plaintext highlighter-rouge">CalculateMainLight</code>, 把Out_Vector1的两个参数改为<code class="language-plaintext highlighter-rouge">Color(3)</code>  <code class="language-plaintext highlighter-rouge">Diffuse(1)</code></p>
      </li>
      <li>
        <p>修改 Lighting.hlsl 文件, 完整代码在下面part</p>
      </li>
      <li>
        <p>在菜单中新建一个sub-graph <code class="language-plaintext highlighter-rouge">AddAdditionLight</code></p>

        <ul>
          <li>在Blackboard里新建3个参数 <code class="language-plaintext highlighter-rouge">MainLIghtDiffuse(Vector1)</code>   <code class="language-plaintext highlighter-rouge">MainLightColor(color)</code> <code class="language-plaintext highlighter-rouge">Smoothness(Vector1)</code></li>
          <li>在Out_Vector里新建3个参数 <code class="language-plaintext highlighter-rouge">Diffuse(Vector1)</code>  <code class="language-plaintext highlighter-rouge">Color(Vector3)</code> <code class="language-plaintext highlighter-rouge">Specular(Vector1)</code></li>
          <li>新建一个<code class="language-plaintext highlighter-rouge">Custom Function</code>, 修改<code class="language-plaintext highlighter-rouge">Lighting.hlsl</code></li>
        </ul>

        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
</pre></td><td class="rouge-code"><pre>#ifndef CUSTOM_LIGHTING_INCLUDED
#define CUSTOM_LIGHTING_INCLUDED
    
void CalculateMainLight_float(float3 WorldPos, out float3 Direction, out float3 Color, out half DistanceAtten, out half ShadowAtten){
	#if SHADERGRAPH_PREVIEW
	Direction = float3(0.5, 0.5, 0);
	Color = 1;
	DistanceAtten = 1;
	ShadowAtten = 1;
    
	#else
		#if SHADOWS_SCREEN
			half4 clipPos = TransformWorldToHClip(WorldPos);
			half4 shadowCoord = ComputeScreenPos(clipPos);
		#else
			half4 shadowCoord = TransformWorldToShadowCoord(WorldPos);
		#endif
    
		Light mainLight = GetMainLight(shadowCoord);
		Direction = mainLight.direction;
		Color = mainLight.color;
    
		DistanceAtten = mainLight.distanceAttenuation;
		ShadowAtten = mainLight.shadowAttenuation;
	#endif
}
    
//接收direction以外类型灯光的配置
void AddAdditionalLights_float(float Smoothness, float3 WorldPosition, float3 WolrdNormal, float3 WorldView, float MainDiffuse, float MainSpecular, float3 MainColor, out float Diffuse, out float Specular, out float3 Color){
	Diffuse = MainDiffuse;
	Specular = MainSpecular;
	Color = MainColor * MainDiffuse;
    
#ifndef SHADERGRAPH_PREVIEW 
	int pixelLightCount = GetAdditionalLightsCount();
	for (int i = 0; i &lt; pixelLightCount; ++i) {
		Light light = GetAdditionalLight(i, WorldPosition);
		half NdotL = saturate(dot(WolrdNormal, light.direction));
		half atten = light.distanceAttenuation * light.shadowAttenuation;
		half thisDiffuse = atten * NdotL;
		half thisSpecular = LightingSpecular(thisDiffuse, light.direction, WolrdNormal, WorldView, 1, Smoothness);
    
		Diffuse += thisDiffuse;
		Color += light.color * (thisDiffuse + thisSpecular);	
	}
#endif
    
	half total = Diffuse + Specular;
	//If no light touches this pixel, set the color to the main light's color
	Color = total &lt;= 0 ? MainColor : Color / total;
    
}
    
#endif
</pre></td></tr></tbody></table></code></pre></div>        </div>

        <ul>
          <li>在<code class="language-plaintext highlighter-rouge">AddAdditionLight - Custom Function</code>里添加</li>
          <li>inputs:
            <ul>
              <li><code class="language-plaintext highlighter-rouge">Smoothness(Vector1)</code></li>
              <li><code class="language-plaintext highlighter-rouge">WorldPostion(Vector3)</code></li>
              <li><code class="language-plaintext highlighter-rouge">WorldNormal(Vector3)</code></li>
              <li><code class="language-plaintext highlighter-rouge">WorldView(Vector3)</code></li>
              <li><code class="language-plaintext highlighter-rouge">MainDiffuse(Vector1)</code></li>
              <li><code class="language-plaintext highlighter-rouge">MainSpecular(Vector1)</code></li>
              <li><code class="language-plaintext highlighter-rouge">MainColor(Vector3)</code></li>
            </ul>
          </li>
          <li>outputs: <code class="language-plaintext highlighter-rouge">Diffuse(Vector1)</code>  <code class="language-plaintext highlighter-rouge">Color(Vector3)</code> <code class="language-plaintext highlighter-rouge">Specular(Vector1)</code></li>
          <li>Name: **要和代码中命名一致 <code class="language-plaintext highlighter-rouge">AddAdditionalLights</code></li>
          <li>Source: Light.hlsl</li>
          <li>新建三个节点 <code class="language-plaintext highlighter-rouge">Position</code>  <code class="language-plaintext highlighter-rouge">Normal Vector</code> <code class="language-plaintext highlighter-rouge">View Direction</code> 连接到Custom Function</li>
          <li>把Blackboard里两个节点拉入, 连到Custom Function</li>
          <li>把Custom Function 连接到出口节点</li>
        </ul>
      </li>
      <li>
        <p>回到 CalculateLight , 加入<code class="language-plaintext highlighter-rouge">AddAdditionalLight</code></p>
      </li>
    </ul>
  </li>
</ul>

<h2 id="贴图">贴图</h2>

<h3 id="漫贴反射图要点">漫贴反射图要点</h3>

<ul>
  <li>如果不需要贴图的反射, 在贴图的Inspector中
    <ul>
      <li>Filter Mode: Point(no filter)</li>
      <li>Compression: None</li>
    </ul>
  </li>
  <li>在材质Inspector中
    <ul>
      <li>Smoothness: 0</li>
    </ul>
  </li>
  <li>在导入的带rig的模型包中, 选择非rig以外所有模型子对象<strong>(不要选rig)</strong>, 拖入材质到 Element 0</li>
</ul>

<h3 id="贴图大小设置">贴图大小设置</h3>

<ul>
  <li>漫反射贴图的UV节点添加<code class="language-plaintext highlighter-rouge">Tiling And Offset</code>
    <ul>
      <li>Tiling: 贴图重复的次数, 数字越大, 重复次数越多, 即贴图越小</li>
      <li>Offset: 偏移
        <ul>
          <li>建立两个vector1- uOffset vOffset , 用 Combine 连接 R 和 B, 出口RGBA连接到Tiling and Offset 的Offset</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>



      </section>


      <!-- <script type="text/javascript">
        $(document).ready(function() {
        $('#toc').toc();
        });
      </script> -->



      <footer>
      <p><small>BackTo <a href="https://8ku.github.io/note_other">Home</a>  |  To<a href="javascript:scroll(0,0)"> TOP</a></small></p>
      <!--  <p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p> -->
      </footer>
    </div>



    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    

  </body>
</html>
