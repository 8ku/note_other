<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <!-- <link rel="stylesheet" href="/note_other/assets/css/syntax.css"> -->
    
<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>保存和读档 | note_other</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="保存和读档" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="书籍以外的各种笔记" />
<meta property="og:description" content="书籍以外的各种笔记" />
<link rel="canonical" href="http://localhost:4000/note_other/post/Code/C_Sharp/Unity_C_Sharp/saveAndLoad.html" />
<meta property="og:url" content="http://localhost:4000/note_other/post/Code/C_Sharp/Unity_C_Sharp/saveAndLoad.html" />
<meta property="og:site_name" content="note_other" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="保存和读档" />
<script type="application/ld+json">
{"url":"http://localhost:4000/note_other/post/Code/C_Sharp/Unity_C_Sharp/saveAndLoad.html","headline":"保存和读档","description":"书籍以外的各种笔记","@type":"WebPage","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <!-- 字体自适应放大 -->
    <link rel="stylesheet" href="/note_other/assets/css/style.css?v=6e16c63238836bca6af2e9013f7f75717d6f21ee">
    <script src="/note_other/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!-- 显示页内目录 -->
    <!-- <script src="https://raw.githubusercontent.com/8ku/note_other/master/_js/jquery-3.5.1.min.js" type="text/javascript"></script> 
    <script src="https://raw.githubusercontent.com/8ku/note_other/master/_js/toc.js" type="text/javascript"></script> -->


	<!-- 显示数学公式 -->
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
            inlineMath: [['$','$']]
            }
        });
    </script> 

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>

    <div class="wrapper">
      <header>
        <h1 class="header"><a href="/note_other">note_other</a></h1>
        <p class="header">书籍以外的各种笔记</p>    
        <ul> 
          <li><a class="header name" href="https://8ku.github.io/note_other/search">Search</a></li>     	
        	<li><a class="header name" href="https://8ku.github.io/note_other/post/Code/summary">Code</a></li>
        	<li><a class="header name" href="https://8ku.github.io/note_other/post/Unity/summary">Unity</a></li>
        	<li><a class="header name" href="https://8ku.github.io/note_other/post/math/summary">Math</a></li>
        	<li><a class="header name" href="https://8ku.github.io/note_other/post/RegularExpression/summary">RegularExpression</a></li>
        	<li><a class="header name" href="https://8ku.github.io/note_other/post/system/summary">System</a></li>
        	<li><a class="header name" href="https://8ku.github.io/note_other/post/WomensHistory/summary">WomensHistory</a></li>
        	<li><a class="header name" href="https://8ku.github.io/note_other/post/mythology/summary">Mythology</a></li>
        	<li><a class="header name" href="https://8ku.github.io/note_other/post/GameHistory/summary">GameHistory</a></li>
        	<li><a class="header name" href="/note_other/post/Biology/summary">Biology</a></li>
        	<li><a class="header name" href="/note_other/post/Draw/summary">Draw</a></li>
        </ul>

        <ul>
            <li><a class="buttons github" href="https://github.com/8ku/note_other">GitHub</a></li>
        </ul>

        <!-- <ul>
          
          <li><a class="buttons github" href="https://github.com/8ku/note_other">View On GitHub</a></li>
        </ul> --> 

        <!-- 
          <p class="header">This project is maintained by <a class="header name" href="https://github.com/8ku">8ku</a></p>
         -->

        <!--   -->
      </header>

      <div id="toc"></div>
      <section>

        <h1 id="保存和读档">保存和读档</h1>

<h2 id="序列化">序列化</h2>

<h3 id="概念">概念</h3>

<p>将要保存的数据进行二进制存储，当需要时，再反序列化回来。</p>

<p>Unity 序列化过程不走 .NET 的方法，用 Unity 内部的方法。</p>

<h3 id="可序列化的对象">可序列化的对象</h3>

<ul>
  <li>所有继承至 UnityEngine.Object 的类，如 MonoBehaviour
    <ul>
      <li>UnityEngine.Object 或 Object 都是序列化数据集合</li>
      <li></li>
    </ul>
  </li>
  <li>所有基本数据类型，如 int，string 等</li>
  <li>一些内置类型， 如 Vector3，Quaternion，Matirx4x4，Color，Rect，LayMask 等
    <ul>
      <li>Unity 中基本所有的对象类型都是内置的</li>
    </ul>
  </li>
  <li>一列可序列化类型的列表</li>
  <li>枚举类型</li>
  <li>结构类型</li>
  <li>可序列化类型中公有非静态字段</li>
  <li>非公有非静态，但带 [SerializeField] 特性的字段</li>
</ul>

<h3 id="不可序列化">不可序列化</h3>

<ul>
  <li>静态字段</li>
  <li>属性（Property）</li>
</ul>

<h3 id="注意点">注意点</h3>

<ul>
  <li>字典不能通过添加 Serializable 属性进行序列化</li>
  <li>如果一个类基类不能被序列化，即使添加了序列化特性也无法被序列化</li>
  <li>序列化不能保存另一个要反序列化的对象指针，因为反序列化是new一个新的对象，指针指向的内存将不会是原对象</li>
</ul>

<p><a href="[http://mosswang.com/2019/04/20/Unity%E7%AC%94%E8%AE%B0/%E8%BD%AC-%E8%B5%84%E4%BA%A7-%E5%AF%B9%E8%B1%A1%E5%92%8C%E5%BA%8F%E5%88%97%E5%8C%96/](http://mosswang.com/2019/04/20/Unity笔记/转-资产-对象和序列化/)">参考</a></p>

<h2 id="存档">存档</h2>

<h3 id="创建一个类保存数据---把数据序列化存到文件">创建一个类保存数据 - 把数据序列化存到文件</h3>

<blockquote>
  <p>序列化技术侧重于解决对象的传输问题，持久化技术侧重于解决对象的存储问题。</p>
</blockquote>

<ul>
  <li>PlayerPrefs：数据持久化方案
    <ul>
      <li>键值对
        <ul>
          <li>` PlayerPrefs.SetInt(“Index”, 1);`</li>
          <li><code class="language-plaintext highlighter-rouge">PlayerPrefs.SetFloat(“Height”,180.5f);</code></li>
          <li><code class="language-plaintext highlighter-rouge">PlayerPrefs.SetString(“Name”,”Tom”);</code></li>
        </ul>
      </li>
      <li>获取数据
        <ul>
          <li><code class="language-plaintext highlighter-rouge">PlayerPrefs.GetInt(“Index”);</code></li>
          <li><code class="language-plaintext highlighter-rouge">PlayerPrefs.GetFloat(“Index”);</code></li>
          <li><code class="language-plaintext highlighter-rouge">PlayerPrefs.GetString(“Index”);</code></li>
        </ul>
      </li>
      <li>适用于使用频繁的数据，需要频繁调用
        <ul>
          <li>药水、技能</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Serialization 序列化
    <ul>
      <li>二进制：通过二进制格式器写入读出，简单，可读性差</li>
      <li>XML，可读性强，文件庞大，冗余信息多
        <ul>
          <li>适用于建立装备数据库</li>
        </ul>
      </li>
      <li>JSON：数据格式简单，易读写，但不直观，可读性比 XML 差
        <ul>
          <li>适用于游戏存档</li>
          <li>json 最好建立在对应不同文件夹下</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
</pre></td><td class="rouge-code"><pre><span class="c1">//以存储角色信息为例</span>

<span class="k">using</span> <span class="nn">System.Collections</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">LitJson</span><span class="p">;</span> <span class="c1">//引用 json 类</span>
<span class="k">using</span> <span class="nn">System.IO</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEditor</span><span class="p">;</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">Person</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">double</span> <span class="n">HP</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Level</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">double</span> <span class="n">Exp</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Attak</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="p">}</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">PersonList</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;</span> <span class="n">dictionary</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;();</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">Classtext</span> <span class="p">:</span> <span class="n">MonoBehaviour</span> <span class="p">{</span>
    <span class="cm">/*定义一个Person对象（其属性包括，Name，HP,Level，Exp,Attak等），
     将其转会成json格式字符串并且写入到person.json的文本中，
     然后将person.json文本中的内容读取出来赋值给新的Person对象。
     */</span>
	
    <span class="k">public</span> <span class="n">PersonList</span> <span class="n">personList</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PersonList</span><span class="p">();</span>

    <span class="c1">// Use this for initialization</span>
    <span class="k">void</span> <span class="nf">Start</span> <span class="p">()</span> <span class="p">{</span>
	    <span class="c1">//初始化人物信息</span>
        <span class="n">Person</span> <span class="n">person</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Person</span><span class="p">();</span>
        <span class="n">person</span><span class="p">.</span><span class="n">Name</span> <span class="p">=</span> <span class="s">"Czhenya"</span><span class="p">;</span>
        <span class="n">person</span><span class="p">.</span><span class="n">HP</span> <span class="p">=</span> <span class="m">100</span><span class="p">;</span>
        <span class="n">person</span><span class="p">.</span><span class="n">Level</span> <span class="p">=</span> <span class="m">30</span><span class="p">;</span>
        <span class="n">person</span><span class="p">.</span><span class="n">Exp</span> <span class="p">=</span> <span class="m">999.99</span><span class="p">;</span>
        <span class="n">person</span><span class="p">.</span><span class="n">Attak</span> <span class="p">=</span> <span class="m">38</span><span class="p">;</span>
		
		<span class="c1">//调用保存方法</span>
       <span class="nf">Save</span><span class="p">(</span><span class="n">person</span><span class="p">);</span>
        
    <span class="p">}</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// 保存JSON数据到本地的方法</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="c1">/// &lt;param name="player"&gt;要保存的对象&lt;/param&gt;</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Save</span><span class="p">(</span><span class="n">Person</span> <span class="n">player</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//打包后Resources文件夹不能存储文件，如需打包后使用自行更换目录</span>
        <span class="kt">string</span> <span class="n">filePath</span> <span class="p">=</span> <span class="n">Application</span><span class="p">.</span><span class="n">dataPath</span> <span class="p">+</span> <span class="s">@"/Resources/JsonPerson.json"</span><span class="p">;</span>
        <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="n">Application</span><span class="p">.</span><span class="n">dataPath</span> <span class="p">+</span> <span class="s">@"/Resources/JsonPerson.json"</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(!</span><span class="n">File</span><span class="p">.</span><span class="nf">Exists</span><span class="p">(</span><span class="n">filePath</span><span class="p">))</span>  <span class="c1">//不存在就创建键值对</span>
        <span class="p">{</span>
            <span class="n">personList</span><span class="p">.</span><span class="n">dictionary</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Name"</span><span class="p">,</span> <span class="n">player</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
            <span class="n">personList</span><span class="p">.</span><span class="n">dictionary</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"HP"</span><span class="p">,</span> <span class="n">player</span><span class="p">.</span><span class="n">HP</span><span class="p">.</span><span class="nf">ToString</span><span class="p">());</span>
            <span class="n">personList</span><span class="p">.</span><span class="n">dictionary</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Level"</span><span class="p">,</span> <span class="n">player</span><span class="p">.</span><span class="n">Level</span><span class="p">.</span><span class="nf">ToString</span><span class="p">());</span>
            <span class="n">personList</span><span class="p">.</span><span class="n">dictionary</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Exp"</span><span class="p">,</span> <span class="n">player</span><span class="p">.</span><span class="n">Exp</span><span class="p">.</span><span class="nf">ToString</span><span class="p">());</span>
            <span class="n">personList</span><span class="p">.</span><span class="n">dictionary</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Attak"</span><span class="p">,</span> <span class="n">player</span><span class="p">.</span><span class="n">Attak</span><span class="p">.</span><span class="nf">ToString</span><span class="p">());</span>

        <span class="p">}</span>
        <span class="k">else</span>   <span class="c1">//若存在就更新值</span>
        <span class="p">{</span>
            <span class="n">personList</span><span class="p">.</span><span class="n">dictionary</span><span class="p">[</span><span class="s">"Name"</span><span class="p">]</span> <span class="p">=</span> <span class="n">player</span><span class="p">.</span><span class="n">Name</span><span class="p">;</span>
            <span class="n">personList</span><span class="p">.</span><span class="n">dictionary</span><span class="p">[</span><span class="s">"HP"</span><span class="p">]</span> <span class="p">=</span> <span class="n">player</span><span class="p">.</span><span class="n">HP</span><span class="p">.</span><span class="nf">ToString</span><span class="p">();</span>
            <span class="n">personList</span><span class="p">.</span><span class="n">dictionary</span><span class="p">[</span><span class="s">"Level"</span><span class="p">]</span> <span class="p">=</span> <span class="n">player</span><span class="p">.</span><span class="n">Level</span><span class="p">.</span><span class="nf">ToString</span><span class="p">();</span>
            <span class="n">personList</span><span class="p">.</span><span class="n">dictionary</span><span class="p">[</span><span class="s">"Exp"</span><span class="p">]</span> <span class="p">=</span> <span class="n">player</span><span class="p">.</span><span class="n">Exp</span><span class="p">.</span><span class="nf">ToString</span><span class="p">();</span>
            <span class="n">personList</span><span class="p">.</span><span class="n">dictionary</span><span class="p">[</span><span class="s">"Attak"</span><span class="p">]</span> <span class="p">=</span> <span class="n">player</span><span class="p">.</span><span class="n">Attak</span><span class="p">.</span><span class="nf">ToString</span><span class="p">();</span>
        <span class="p">}</span>
       
        <span class="c1">//找到当前路径</span>
        <span class="n">FileInfo</span> <span class="n">file</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">FileInfo</span><span class="p">(</span><span class="n">filePath</span><span class="p">);</span>
        <span class="c1">//判断有没有文件，有则打开文件，，没有创建后打开文件</span>
        <span class="n">StreamWriter</span> <span class="n">sw</span> <span class="p">=</span> <span class="n">file</span><span class="p">.</span><span class="nf">CreateText</span><span class="p">();</span>
        <span class="c1">//ToJson接口将你的列表类传进去，，并自动转换为string类型</span>
        <span class="kt">string</span> <span class="n">json</span> <span class="p">=</span> <span class="n">JsonMapper</span><span class="p">.</span><span class="nf">ToJson</span><span class="p">(</span><span class="n">personList</span><span class="p">.</span><span class="n">dictionary</span><span class="p">);</span> 
        <span class="c1">//将转换好的字符串存进文件，</span>
        <span class="n">sw</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">json</span><span class="p">);</span>
        <span class="c1">//注意释放资源</span>
        <span class="n">sw</span><span class="p">.</span><span class="nf">Close</span><span class="p">();</span>
        <span class="n">sw</span><span class="p">.</span><span class="nf">Dispose</span><span class="p">();</span>

        <span class="n">AssetDatabase</span><span class="p">.</span><span class="nf">Refresh</span><span class="p">();</span>

    <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// 读取保存数据的方法</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">LoadPerson</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//调试用的  //Debug.Log(1);</span>
        
        <span class="c1">//TextAsset该类是用来读取配置文件的</span>
        <span class="n">TextAsset</span> <span class="n">asset</span> <span class="p">=</span> <span class="n">Resources</span><span class="p">.</span><span class="nf">Load</span><span class="p">(</span><span class="s">"JsonPerson"</span><span class="p">)</span> <span class="k">as</span> <span class="n">TextAsset</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(!</span><span class="n">asset</span><span class="p">)</span>  <span class="c1">//读不到就退出此方法</span>
            <span class="k">return</span><span class="p">;</span>

        <span class="kt">string</span> <span class="n">strdata</span> <span class="p">=</span> <span class="n">asset</span><span class="p">.</span><span class="n">text</span><span class="p">;</span>		
        <span class="n">JsonData</span> <span class="n">jsdata3</span> <span class="p">=</span> <span class="n">JsonMapper</span><span class="p">.</span><span class="nf">ToObject</span><span class="p">(</span><span class="n">strdata</span><span class="p">);</span>
		<span class="c1">//在这里循环输出表示读到了数据，即此数据可以使用了，ToObject 把json 转成对象</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">jsdata3</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="n">jsdata3</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="p">}</span>
        <span class="c1">//使用foreach输出的话会以[键，值]，，，</span>
		<span class="cm">/*foreach (var item in jsdata3)
        {
            Debug.Log(item);
        }*/</span>

    <span class="p">}</span>
	
    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnGUI</span><span class="p">()</span>
    <span class="p">{</span>   <span class="c1">//点击读取存储的文件</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">GUILayout</span><span class="p">.</span><span class="nf">Button</span><span class="p">(</span><span class="s">"LoadTXT"</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="nf">LoadPerson</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="参考-api">参考 API</h2>

<ul>
  <li><a href="https://litjson.net/api/LitJson/JsonMapper/">LitJson</a></li>
</ul>



      </section>


      <!-- <script type="text/javascript">
        $(document).ready(function() {
        $('#toc').toc();
        });
      </script> -->



      <footer>
      <p><small>BackTo <a href="https://8ku.github.io/note_other">Home</a>  |  To<a href="javascript:scroll(0,0)"> TOP</a></small></p>
      <!--  <p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p> -->
      </footer>
    </div>



    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    

  </body>
</html>
