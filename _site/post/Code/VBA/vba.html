<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <!-- <link rel="stylesheet" href="/note_other/assets/css/syntax.css"> -->
    
<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>VBA | note_other</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="VBA" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="书籍以外的各种笔记" />
<meta property="og:description" content="书籍以外的各种笔记" />
<link rel="canonical" href="http://localhost:4000/note_other/post/Code/VBA/vba.html" />
<meta property="og:url" content="http://localhost:4000/note_other/post/Code/VBA/vba.html" />
<meta property="og:site_name" content="note_other" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="VBA" />
<script type="application/ld+json">
{"url":"http://localhost:4000/note_other/post/Code/VBA/vba.html","headline":"VBA","description":"书籍以外的各种笔记","@type":"WebPage","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <!-- 字体自适应放大 -->
    <link rel="stylesheet" href="/note_other/assets/css/style.css?v=6e16c63238836bca6af2e9013f7f75717d6f21ee">
    <script src="/note_other/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!-- 显示页内目录 -->
    <!-- <script src="https://raw.githubusercontent.com/8ku/note_other/master/_js/jquery-3.5.1.min.js" type="text/javascript"></script> 
    <script src="https://raw.githubusercontent.com/8ku/note_other/master/_js/toc.js" type="text/javascript"></script> -->


	<!-- 显示数学公式 -->
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
            inlineMath: [['$','$']]
            }
        });
    </script> 

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>

    <div class="wrapper">
      <header>
        <h1 class="header"><a href="/note_other">note_other</a></h1>
        <p class="header">书籍以外的各种笔记</p>    
        <ul> 
          <li><a class="header name" href="https://8ku.github.io/note_other/search">Search</a></li>     	
        	<li><a class="header name" href="https://8ku.github.io/note_other/post/Code/summary">Code</a></li>
        	<li><a class="header name" href="https://8ku.github.io/note_other/post/Unity/summary">Unity</a></li>
        	<li><a class="header name" href="https://8ku.github.io/note_other/post/math/summary">Math</a></li>
        	<li><a class="header name" href="https://8ku.github.io/note_other/post/RegularExpression/summary">RegularExpression</a></li>
        	<li><a class="header name" href="https://8ku.github.io/note_other/post/system/summary">System</a></li>
        	<li><a class="header name" href="https://8ku.github.io/note_other/post/WomensHistory/summary">WomensHistory</a></li>
        	<li><a class="header name" href="https://8ku.github.io/note_other/post/mythology/summary">Mythology</a></li>
        	<li><a class="header name" href="https://8ku.github.io/note_other/post/GameHistory/summary">GameHistory</a></li>
        	<li><a class="header name" href="/note_other/post/Biology/summary">Biology</a></li>
        	<li><a class="header name" href="/note_other/post/Draw/summary">Draw</a></li>
        </ul>

        <ul>
            <li><a class="buttons github" href="https://github.com/8ku/note_other">GitHub</a></li>
        </ul>

        <!-- <ul>
          
          <li><a class="buttons github" href="https://github.com/8ku/note_other">View On GitHub</a></li>
        </ul> --> 

        <!-- 
          <p class="header">This project is maintained by <a class="header name" href="https://github.com/8ku">8ku</a></p>
         -->

        <!--   -->
      </header>

      <div id="toc"></div>
      <section>

        <h1 id="vba">VBA</h1>

<p><a href="https://www.w3cschool.cn/excelvba/excelvba-basics.html">参考链接</a></p>

<h2 id="基本知识点">基本知识点</h2>

<ul>
  <li>
    <p>Dim</p>

    <ul>
      <li>Dimension(尺寸)的缩写，用来声明代码中的变量。</li>
      <li>声明 ：<code class="language-plaintext highlighter-rouge">Dim age As Integer</code></li>
    </ul>
  </li>
  <li>
    <p>VBA中的数据类型</p>

    <p><img src="/note_other/post/Code/VBA/vba.assets/201611140928061888.png" alt="201611140928061888" /></p>
  </li>
  <li>
    <p>添加注释</p>

    <ul>
      <li>在行前添加英文单引号，注释也可以写在代码后</li>
    </ul>
  </li>
  <li>
    <p>宏过程</p>

    <ul>
      <li>
        <p>所有宏过程都以关键词 <code class="language-plaintext highlighter-rouge">Sub</code>开始，<code class="language-plaintext highlighter-rouge">End Sub</code>结尾。</p>
      </li>
      <li>
        <div class="language-vb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="k">Sub</span> <span class="nf">code</span><span class="p">()</span>
<span class="k">Dim</span> <span class="nv">i</span> <span class="ow">As</span> <span class="kt">Integer</span>
<span class="c1">'按用户名标记角色</span>
<span class="k">For</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">To</span> <span class="mi">348</span>
    <span class="k">If</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="n">Value</span> <span class="ow">Like</span> <span class="s">"*lsa*"</span> <span class="ow">Or</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="n">Value</span> <span class="ow">Like</span> <span class="s">"*峰*"</span> <span class="k">Then</span>
        <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span> <span class="o">=</span> <span class="s">"测试人员"</span>
    <span class="k">ElseIf</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="n">Value</span> <span class="ow">Like</span> <span class="s">"*ac*"</span> <span class="ow">Or</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="n">Value</span> <span class="ow">Like</span> <span class="s">"Na*"</span> <span class="k">Then</span>
        <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span> <span class="o">=</span> <span class="s">"worker"</span>
    <span class="k">ElseIf</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="n">Value</span> <span class="ow">Like</span> <span class="s">"*瑞*"</span> <span class="k">Then</span>
        <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span> <span class="o">=</span> <span class="s">"robot"</span>
    <span class="k">Else</span>
        <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span> <span class="o">=</span> <span class="s">"user"</span>
    <span class="k">End</span> <span class="k">If</span>
<span class="k">Next</span>
<span class="k">End</span> <span class="k">Sub</span>
</pre></td></tr></tbody></table></code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>Range属性</p>

    <ul>
      <li>Range属性返回一个单元格或单元格区域</li>
      <li>选择一个单元格 <code class="language-plaintext highlighter-rouge">range("a5").select</code></li>
      <li>选择一个单元格区域 <code class="language-plaintext highlighter-rouge">range("a6:a10").select</code></li>
      <li>选择一些不相邻的单元格 <code class="language-plaintext highlighter-rouge">range("a1,b6,c8").select</code></li>
      <li>选择一些不相邻的单元格和单元格区域 <code class="language-plaintext highlighter-rouge">range("a11:d11,c12,d3").select</code></li>
    </ul>
  </li>
  <li>
    <p>Cells属性</p>

    <ul>
      <li>cells属性返回一个单元格</li>
      <li>Cell要求两个自变量，第一个是行号，第二个是列号或列字母</li>
      <li>选择一个单元格：<code class="language-plaintext highlighter-rouge">cells(5,1).select</code>或<code class="language-plaintext highlighter-rouge">cells(5,a).select</code></li>
      <li>选择一个单元格区域：<code class="language-plaintext highlighter-rouge">range(cells(6,1),cells(10,1)).select</code></li>
      <li>选择工作表所有单元格：<code class="language-plaintext highlighter-rouge">cells.select</code></li>
    </ul>
  </li>
  <li>
    <p>Offset属性</p>

    <ul>
      <li>Offset基于当前选择选择的单元格来选择一个位置</li>
      <li>选择a1下一行和右边三列的单元格：<code class="language-plaintext highlighter-rouge">range("a1").offset(1,3).select</code></li>
      <li>选择d15上面两行和左边一列的单元格：<code class="language-plaintext highlighter-rouge">range(d15).offset(-2,-1).select</code></li>
      <li>选择当前单元格上面一行的单元格（同列）：<code class="language-plaintext highlighter-rouge">Selection.offset(-1,0).select</code></li>
    </ul>
  </li>
  <li>
    <p>选择行和列</p>

    <ul>
      <li>
        <p>选择当前活动单元格所在行：<code class="language-plaintext highlighter-rouge">selection.entirerow.select</code></p>
      </li>
      <li>
        <p>选择当前活动单元格所在列：<code class="language-plaintext highlighter-rouge">selection.entirecolusmn.select</code></p>
      </li>
      <li>
        <p>统计选择区域的行数和列数</p>

        <ul>
          <li>
            <div class="language-vb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="n">range</span><span class="p">(</span><span class="s">"a1:d15"</span><span class="p">).</span><span class="n">select</span>
    <span class="err">?</span><span class="n">selection</span><span class="p">.</span><span class="n">rows</span><span class="p">.</span><span class="n">count</span> <span class="c1">'统计行数</span>
    <span class="err">?</span><span class="n">selection</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">count</span> <span class="c1">'统计列数</span>
    <span class="err">?</span><span class="n">selection</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">count</span> <span class="c1">'统计单元格数</span>
</pre></td></tr></tbody></table></code></pre></div>            </div>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p>往表中输入数据</p>

    <ul>
      <li>输入文本：<code class="language-plaintext highlighter-rouge">range("a5").formula = "amount due"</code></li>
      <li>输入数字：<code class="language-plaintext highlighter-rouge">range("a5").value = 123</code></li>
      <li>输入公式：<code class="language-plaintext highlighter-rouge">range("a5").formula = "= d21 * 3"</code></li>
    </ul>
  </li>
  <li>
    <p>返回表中数据</p>

    <ul>
      <li>返回值：<code class="language-plaintext highlighter-rouge">?range("a1").value</code></li>
      <li>返回单元格里的公式：<code class="language-plaintext highlighter-rouge">?range("a1").formula</code></li>
    </ul>
  </li>
  <li>
    <p>移动、复制和删除单元格</p>

    <ul>
      <li>
        <p>移动单元格a5的内容到单元格a4里</p>
      </li>
      <li>
        <div class="language-vb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="n">range</span><span class="p">(</span><span class="s">"a5"</span><span class="p">).</span><span class="n">cut</span>
<span class="n">destination</span><span class="p">:</span><span class="o">=</span><span class="n">range</span><span class="p">(</span><span class="s">"a4"</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div>        </div>
      </li>
      <li>
        <p>复制单元格a3公式到区域 d5:f5 中</p>
      </li>
      <li>
        <div class="language-vb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="n">range</span><span class="p">(</span><span class="s">"a3"</span><span class="p">).</span><span class="n">copy</span>
<span class="n">destination</span><span class="p">:</span><span class="o">=</span><span class="n">range</span><span class="p">(</span><span class="s">"d5:f5"</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div>        </div>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">clearcontents</code>：仅清除单元格或单元格区域内的数据</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">clearformats</code>：仅清除格式</p>
      </li>
      <li><code class="language-plaintext highlighter-rouge">clearContents</code>：清除区域里所有批注</li>
    </ul>
  </li>
  <li>
    <p>excel对象树型图</p>

    <p><img src="/note_other/post/Code/VBA/vba.assets/09010004-e972fdbf517d49f5a88b3b510a9f64e8.png" alt="Basic Excel Object Model " /></p>
  </li>
  <li>
    <p>打断长语句</p>

    <ul>
      <li>
        <p>VB使用一个专门的连续线（下划线）置于一行代码的末尾，表明下一行是这行的连续。必须在下划线之后带一个空格</p>
      </li>
      <li>
        <div class="language-vb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="n">Selection</span><span class="p">.</span><span class="n">PasteSpecial</span> <span class="n">_</span>
             <span class="n">Paste</span><span class="p">:</span><span class="o">=</span><span class="n">xlValues</span><span class="p">,</span> <span class="n">_</span>
             <span class="n">Operation</span><span class="p">:</span><span class="o">=</span><span class="n">xlMultiply</span><span class="p">,</span> <span class="n">_</span>
             <span class="n">SkipBlanks</span><span class="p">:</span> <span class="o">=</span><span class="k">False</span><span class="p">,</span> <span class="n">_</span>
             <span class="n">Transpose</span><span class="p">:</span><span class="o">=</span><span class="k">False</span>
</pre></td></tr></tbody></table></code></pre></div>        </div>
      </li>
      <li>
        <p>以下情况可以使用连续符：</p>

        <ul>
          <li>运算符之前或之后，例如 &amp;，+，Like，NOT，AND</li>
          <li>逗号之前或之后</li>
          <li>冒号和秸之前或之后</li>
          <li>等号之前或之后</li>
        </ul>
      </li>
      <li>
        <p>不能在冒号和等于号之间使用连续符</p>
      </li>
      <li>不能在引号之内的文本间加连续符</li>
    </ul>
  </li>
</ul>

<h2 id="技巧">技巧</h2>

<ul>
  <li>用立即窗口检验代码</li>
  <li>激活表 <code class="language-plaintext highlighter-rouge">Worksheets("Sheet2").Activate</code></li>
  <li>使用 ？或 print 得到命令作用的单元格信息
    <ul>
      <li>?Selection.Address</li>
      <li>print ActiveWorkbook.Name</li>
    </ul>
  </li>
  <li>给选中的单元格或区域设置格式
    <ul>
      <li><code class="language-plaintext highlighter-rouge">Range("A2").NumberFormat = "yyyy/m/d"</code></li>
    </ul>
  </li>
</ul>

<h3 id="工作簿和工作表操作方法">工作簿和工作表操作方法</h3>

<ul>
  <li>打开新工作簿：workbooks.add</li>
  <li>获得第一个工作簿的名称：?workbooks(1).name</li>
  <li>获得打开的工作簿数目：?workbooks.count</li>
  <li>激活第二个打开的工作簿：workbooks(2).activate</li>
  <li>激活某个工作簿：workbooks(“chap02.xls”).activate</li>
  <li>当前活动的工作簿存盘：activeworkbook.saveas filename:=“newchap.xls”</li>
  <li>关闭第一个工作簿：workbooks(1).close</li>
  <li>关闭当前活动的工作簿，不保存变化：activeworkbook.close savechanges:=false</li>
  <li>关闭所有打开的工作簿：workbooks.close</li>
  <li>添加一个新工作表：worksheets.add</li>
  <li>获得第一个工作表名称：?worksheets(1).name</li>
  <li>选择名为“sheet3”的工作表：worksheets(3).select</li>
  <li>选择第一，第三和第四个工作表：worksheets(array(1,3,4)).select</li>
  <li>激活某个工作表：worksheets(“sheet1”).activate</li>
  <li>重命名工作表：worksheets(“sheet2”).name = “expenses”</li>
  <li>获得当前工作簿里的工作表数目：?worksheets.count</li>
  <li>删除当前工作簿里的某个工作表：worksheets(“sheet1”).delete</li>
</ul>

<h3 id="变量">变量</h3>

<ul>
  <li>
    <p>强制显式声明：Dim 变量名 As 数据类型 <code class="language-plaintext highlighter-rouge">Dim DateOfBirth As Date</code></p>
  </li>
  <li>
    <p>隐式声明：变量名 = 值 <code class="language-plaintext highlighter-rouge">DaysLeft = 100</code></p>
  </li>
  <li>
    <div class="language-vb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="k">Sub</span> <span class="nf">AgeCalc</span><span class="p">(</span> <span class="p">)</span>
    <span class="c1">'variable declaration （变量声明）</span>
    <span class="k">Dim</span> <span class="nv">FullName</span> <span class="ow">As</span> <span class="kt">String</span> <span class="n">DateOfBirth</span> <span class="ow">As</span> <span class="kt">Date</span> <span class="n">Age</span> <span class="ow">As</span> <span class="kt">Integer</span>
    <span class="c1">'assign values to variables （赋值给变量）</span>
     <span class="n">FullName</span> <span class="o">=</span> <span class="s">"John Smith"</span>
     <span class="n">DateOfBirth</span> <span class="o">=</span> <span class="p">#</span><span class="mi">01</span><span class="o">/</span><span class="mi">03</span><span class="o">/</span><span class="mi">1967</span><span class="p">#</span>
     <span class="c1">'calculate age （计算年龄）</span>
     <span class="n">Age</span> <span class="o">=</span> <span class="n">Year</span><span class="p">(</span><span class="n">Now</span><span class="p">())</span><span class="o">-</span><span class="n">Year</span><span class="p">(</span><span class="n">DateOfBirth</span><span class="p">)</span>
     <span class="c1">'print results to the Immediate window （在立即窗口里打印结果）</span>
      <span class="n">Debug</span><span class="p">.</span><span class="n">Print</span> <span class="n">FullName</span> <span class="o">&amp;</span> <span class="s">" is "</span> <span class="o">&amp;</span> <span class="n">Age</span> <span class="o">&amp;</span> <span class="s">" years old."</span>
<span class="k">End</span> <span class="k">Sub</span>
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>
    <p>用特殊字符声明变量类型</p>

    <ul>
      <li>integer %</li>
      <li>long &amp;</li>
      <li>single !</li>
      <li>double #</li>
      <li>currency @</li>
      <li>string $</li>
      <li>举例：<code class="language-plaintext highlighter-rouge">Dim FirstName$</code></li>
    </ul>
  </li>
  <li>
    <p>串联：你可以将两个或多个字符串结合成为一个新的字符串 <code class="language-plaintext highlighter-rouge">“Hisnameis”&amp;FirstName</code> = His name is John</p>
  </li>
  <li>
    <p>变量赋值</p>

    <div class="language-vb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="k">Sub</span> <span class="nf">CalcCost</span><span class="p">()</span>
<span class="n">slsPrice</span> <span class="o">=</span> <span class="mi">35</span>
            <span class="n">slsTax</span> <span class="o">=</span> <span class="mf">0.085</span>
            <span class="n">Range</span><span class="p">(</span><span class="s">"A1"</span><span class="p">).</span><span class="n">Formula</span> <span class="o">=</span> <span class="s">"The cost of calculator"</span>
            <span class="n">Range</span><span class="p">(</span><span class="s">"A4"</span><span class="p">).</span><span class="n">Formula</span> <span class="o">=</span> <span class="s">"Price"</span>
            <span class="n">Range</span><span class="p">(</span><span class="s">"B4"</span><span class="p">).</span><span class="n">Formula</span> <span class="o">=</span> <span class="n">slsPrice</span>
            <span class="n">Range</span><span class="p">(</span><span class="s">"A5"</span><span class="p">).</span><span class="n">Formula</span> <span class="o">=</span> <span class="s">"Sales Tax"</span>
            <span class="n">Range</span><span class="p">(</span><span class="s">"A6"</span><span class="p">).</span><span class="n">Formula</span> <span class="o">=</span> <span class="s">"Cost"</span>
    <span class="c1">'给b5的内容限定数据类型</span>
            <span class="n">Range</span><span class="p">(</span><span class="s">"B5"</span><span class="p">).</span><span class="n">Formula</span> <span class="o">=</span> <span class="n">Format</span><span class="p">((</span><span class="n">slsPrice</span> <span class="o">*</span> <span class="n">slsTax</span><span class="p">),</span> <span class="s">"0.00"</span><span class="p">)</span>
    <span class="c1">'给cost的内容限定数据类型</span>
            <span class="n">Cost</span> <span class="o">=</span> <span class="n">Format</span><span class="p">(</span><span class="n">slsPrice</span> <span class="o">+</span> <span class="p">(</span><span class="n">slsPrice</span> <span class="o">*</span> <span class="n">slsTax</span><span class="p">),</span> <span class="s">"0.00"</span><span class="p">)</span>
            <span class="n">Range</span><span class="p">(</span><span class="s">"B6"</span><span class="p">).</span><span class="n">Formula</span> <span class="o">=</span> <span class="n">Cost</span>
  
<span class="n">strMsg</span> <span class="o">=</span> <span class="s">"The calculator total is "</span> <span class="o">&amp;</span> <span class="s">"$"</span> <span class="o">&amp;</span> <span class="n">Cost</span> <span class="o">&amp;</span> <span class="s">"."</span>
<span class="n">Range</span><span class="p">(</span><span class="s">"A8"</span><span class="p">).</span><span class="n">Formula</span> <span class="o">=</span> <span class="n">strMsg</span>
<span class="k">End</span> <span class="k">Sub</span>
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>
    <p>工程级别变量</p>

    <ul>
      <li>
        <p>使用 public 声明，可以在VBA的任何模块里使用</p>

        <div class="language-vb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="k">Option</span> <span class="n">Explicit</span>
<span class="k">Public</span> <span class="n">slsTax</span> <span class="ow">As</span> <span class="k">Single</span>
<span class="k">Sub</span> <span class="nf">CalcCost</span><span class="p">(</span> <span class="p">)</span>
            <span class="o">&lt;</span><span class="err">过程代码</span><span class="o">&gt;</span>
<span class="k">End</span> <span class="k">Sub</span>
</pre></td></tr></tbody></table></code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<h2 id="vba自定义函数">VBA自定义函数</h2>

<p>用户可以创建excel没有提供的函数。</p>

<ol>
  <li>打开一个新Excel工作簿，并保存为Chap04.xls</li>
  <li>切换到VB编辑器窗口并且选择VBAProject(Chap04.xls)</li>
  <li>在属性窗口，将VBAProject改为MyFunctions</li>
  <li>在工程浏览器窗口选择MyFunctions(Chap04.xls)，然后选择“插入”－“模块”</li>
  <li>在属性窗口将“模块1”改为Sample1</li>
  <li>在工程浏览器窗口，点击Sample1并选择“插入”－“过程”（译者：需要激活右边的代码窗口）。</li>
</ol>

<p>类型：函数</p>

<p>范围：公共的，关键字为 Function</p>

<div class="language-vb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="k">Public</span> <span class="k">Function</span> <span class="nf">SumItUp</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> 
	<span class="n">SumItUp</span> <span class="o">=</span> <span class="n">m</span> <span class="o">+</span> <span class="n">n</span>
<span class="k">End</span> <span class="k">Function</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>当设置为公共函数时，用户可以在excel表格中直接调用：</p>

<p><img src="/note_other/post/Code/VBA/vba.assets/image-20200311171922867.png" alt="image-20200311171922867" /></p>

<p>编辑时，选择结果单元格，点击工具栏上的 fx 按钮编辑</p>

<h3 id="调试">调试</h3>

<ol>
  <li>用debug.print 来输入结果</li>
  <li>在立即窗口中输入 ?SumItUp(34,55)</li>
</ol>

<h3 id="函数过程不能做什么">函数过程不能做什么</h3>

<p>函数过程不能进行任何动作，例如，它们不能在工作表里做插入，删除或设置数据格式操作，不能打开文件，或改变屏幕显示样式</p>

<h2 id="excel技巧">Excel技巧</h2>

<ul>
  <li>减1秒：=D2-1/24/60/60</li>
</ul>

<div class="language-vb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td><td class="rouge-code"><pre><span class="k">Sub</span> <span class="nf">code</span><span class="p">()</span>
<span class="k">Dim</span> <span class="nv">i</span> <span class="ow">As</span> <span class="kt">Integer</span>
<span class="k">Dim</span> <span class="nv">pushType</span>  <span class="ow">As</span> <span class="kt">String</span>
<span class="k">Dim</span> <span class="nv">receType</span> <span class="ow">As</span> <span class="kt">String</span>
<span class="k">Dim</span> <span class="nv">pushDate</span> <span class="ow">As</span> <span class="kt">Date</span>
<span class="k">Dim</span> <span class="nv">receDate</span> <span class="ow">As</span> <span class="kt">Date</span>
<span class="k">Dim</span> <span class="nv">resultDate</span>
<span class="n">lastRow</span> <span class="o">=</span> <span class="n">ActiveSheet</span><span class="p">.</span><span class="n">UsedRange</span><span class="p">.</span><span class="n">Rows</span><span class="p">.</span><span class="n">Count</span>

<span class="n">receType</span> <span class="o">=</span> <span class="s">"receive"</span>
<span class="n">pushType</span> <span class="o">=</span> <span class="s">"push"</span>
<span class="n">j</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">For</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">To</span> <span class="n">lastRow</span>
   <span class="k">For</span> <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">To</span> <span class="n">lastRow</span>
    <span class="k">If</span> <span class="n">Cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="n">Value</span> <span class="o">=</span> <span class="n">Cells</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="n">Value</span> <span class="k">Then</span>
        <span class="k">If</span> <span class="n">Cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">).</span><span class="n">Value</span> <span class="o">=</span> <span class="s">"receive"</span> <span class="ow">And</span> <span class="n">Cells</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">2</span><span class="p">).</span><span class="n">Value</span> <span class="o">=</span> <span class="s">"push"</span> <span class="k">Then</span>
            <span class="n">receDate</span> <span class="o">=</span> <span class="n">Cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
            <span class="n">pushDate</span> <span class="o">=</span> <span class="n">Cells</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
            <span class="k">If</span> <span class="n">DateValue</span><span class="p">(</span><span class="n">pushDate</span><span class="p">)</span> <span class="o">-</span> <span class="n">DateValue</span><span class="p">(</span><span class="n">receDate</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="k">Then</span>
                <span class="n">Cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span> <span class="o">=</span> <span class="s">"yes"</span>
                <span class="n">Cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">=</span> <span class="n">Cells</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">4</span><span class="p">).</span><span class="n">Value</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">Else</span>
                <span class="n">Cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span> <span class="o">=</span> <span class="s">"no"</span>
            <span class="k">End</span> <span class="k">If</span>
        <span class="k">Else</span>
            <span class="n">Cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span> <span class="o">=</span> <span class="s">"no"</span>
        <span class="k">End</span> <span class="k">If</span>
    <span class="k">End</span> <span class="k">If</span>
    <span class="n">j</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">Next</span>
<span class="k">Next</span>
<span class="k">End</span> <span class="k">Sub</span>

</pre></td></tr></tbody></table></code></pre></div></div>



      </section>


      <!-- <script type="text/javascript">
        $(document).ready(function() {
        $('#toc').toc();
        });
      </script> -->



      <footer>
      <p><small>BackTo <a href="https://8ku.github.io/note_other">Home</a>  |  To<a href="javascript:scroll(0,0)"> TOP</a></small></p>
      <!--  <p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p> -->
      </footer>
    </div>



    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    

  </body>
</html>
